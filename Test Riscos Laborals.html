<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test de Prevenci贸 de Riscos Laborals</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Estils per a la barra de progr茅s */
    #progress-container {
      width: 100%;
      background-color: #e0e0e0;
      border-radius: 5px;
      overflow: hidden;
      margin-bottom: 1rem;
    }

    #progress-bar {
      height: 20px;
      background-color: #4CAF50;
      width: 0%;
      border-radius: 5px;
      text-align: center;
      color: white;
      transition: width 0.5s ease-in-out;
    }

    /* Estils per al modal */
    .modal {
      display: none; /* Hidden by default */
      position: fixed; /* Stay in place */
      z-index: 1000; /* Sit on top */
      left: 0;
      top: 0;
      width: 100%; /* Full width */
      height: 100%; /* Full height */
      overflow: auto; /* Enable scroll if needed */
      background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background-color: #fefefe;
      margin: auto;
      padding: 20px;
      border: 1px solid #888;
      width: 80%;
      max-width: 500px;
      border-radius: 10px;
      text-align: center;
    }

    .close-button {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
    }

    .close-button:hover,
    .close-button:focus {
      color: black;
      text-decoration: none;
      cursor: pointer;
    }

    .fade { transition: all 0.3s ease-in-out; }
    input[type="text"]:focus {
      border-color: #3B82F6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.45);
      outline: none;
    }

    .disabled-option {
      pointer-events: none;
      opacity: 0.6;
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-800 min-h-screen p-4 flex items-center justify-center">
  <div id="app" class="max-w-3xl w-full bg-white shadow-xl rounded-2xl p-6">
    <h1 class="text-3xl font-bold mb-6 text-center text-blue-700">Test de Prevenci贸 de Riscos Laborals</h1>

    <div id="barra-nivells" class="flex flex-wrap justify-center gap-3 mb-6">
      <button onclick="iniciaNivell(1)" class="level-button bg-blue-600 text-white px-5 py-2 rounded-lg hover:bg-blue-700 transition-colors duration-200">Nivell 1</button>
      <button onclick="iniciaNivell(2)" class="level-button bg-green-600 text-white px-5 py-2 rounded-lg hover:bg-green-700 transition-colors duration-200">Nivell 2</button>
      <button onclick="iniciaNivell(3)" class="level-button bg-purple-600 text-white px-5 py-2 rounded-lg hover:bg-purple-700 transition-colors duration-200">Nivell 3</button>
    </div>

    <div id="progress-container" class="mb-6 hidden">
      <div id="progress-bar">0%</div>
    </div>

    <div id="quiz-container" class="hidden">
      <div id="question-area"></div>
      <div id="feedback" class="mt-4 text-center text-lg font-semibold"></div>
      <div class="flex justify-between items-center mt-6">
        <div id="score" class="text-base text-gray-600">Encerts: 0 / 0</div>
        <button id="next-btn" class="hidden bg-blue-600 text-white px-5 py-2 rounded-lg hover:bg-blue-700 transition-colors duration-200">Seg眉ent</button>
      </div>
    </div>

    <div id="nivellCompletatModal" class="modal">
      <div class="modal-content">
        <span class="close-button" onclick="amagaModal()">&times;</span>
        <h2 id="nivellCompletatText" class="text-2xl font-bold mb-4"></h2>
        <p class="text-gray-700 mb-6">Has respost totes les preguntes d'aquest nivell.</p>
        <button onclick="repetirNivell()" class="bg-yellow-500 text-white px-6 py-2 rounded-lg hover:bg-yellow-600 transition-colors duration-200 mr-4">Repetir Nivell</button>
        <button id="botoPujarNivell" onclick="pujarNivell()" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors duration-200 hidden">Pujar al seg眉ent Nivell</button>
      </div>
    </div>

    <div id="repasModal" class="modal">
      <div class="modal-content">
        <span class="close-button" onclick="amagaRepasModal()">&times;</span>
        <h2 class="text-2xl font-bold mb-4">Reps de Preguntes Fallades</h2>
        <p class="text-gray-700 mb-6">Aqu铆 tens les preguntes que no has encertat per revisar-les.</p>
        <div id="preguntesFalladesContainer" class="text-left max-h-80 overflow-y-auto mb-6 p-2 border rounded-lg bg-gray-50"></div>
        <button onclick="amagaRepasModal()" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors duration-200">Entenc</button>
      </div>
    </div>

    <div id="finalTestModal" class="modal">
      <div class="modal-content">
        <span class="close-button" onclick="amagaFinalTestModal()">&times;</span>
        <h2 class="text-2xl font-bold mb-4">隆Test Finalitzat!</h2>
        <p class="text-gray-700 mb-6">Has completat tots els nivells. 隆Felicitats!</p>
        <button onclick="iniciaNivell(1); amagaFinalTestModal();" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors duration-200 mr-4">Tornar a comen莽ar</button>
        <button onclick="mostraRepasFallades()" class="bg-red-500 text-white px-6 py-2 rounded-lg hover:bg-red-600 transition-colors duration-200">Revisar fallades</button>
      </div>
    </div>

  </div>

  <script>
    let totsElsNivellsPreguntes = {
      1: [
        // Preguntas del PDF - Ejercicio 1 (Test)
        {
          pregunta: "Seg煤n la Organizaci贸n Mundial de la Salud (OMS), la salud se puede definir como:",
          tipus: "test",
          opcions: [
            "No padecer enfermedades f铆sicas",
            "No sufrir enfermedades ps铆quicas.",
            "No padecer estr茅s.",
            "El estado completo del bienestar f铆sico, ps铆quico y social."
          ],
          correcta: 3
        },
        {
          pregunta: "Los da帽os derivados del trabajo son:",
          tipus: "test",
          opcions: [
            "Las enfermedades patol贸gicas o lesiones sufridas con motivo u ocasi贸n del trabajo.",
            "Las incapacidades temporales con baja superior a cinco d铆as",
            "La insatisfacci贸n laboral por los ritmos de trabajo.",
            "Las lesiones producidas por no utilizar los medios de protecci贸n personal."
          ],
          correcta: 0
        },
        {
          pregunta: "La Ley de Prevenci贸n de Riesgos Laborales entiende por accidente:",
          tipus: "test",
          opcions: [
            "El suceso que produce lesiones al trabajador.",
            "El acontecimiento que causa da帽os a la maquinaria de la empresa.",
            "Cualquier acontecimiento imprevisto que interrumpa o interfiera el proceso ordenado de la actividad laboral, a煤n cuando no haya habido personas lesionadas.",
            "El suceso que produce da帽os materiales y lesiones corporales."
          ],
          correcta: 2
        },
        {
          pregunta: "El empresario organizar谩 el desarrollo de la actividad preventiva en las empresas que carezcan de riesgos importantes y que tengan menos de 6 trabajadores:",
          tipus: "test",
          opcions: [
            "Asumiendo personalmente la actividad.",
            "Constituyendo un servicio de prevenci贸n propio.",
            "Constituyendo un servicio de prevenci贸n ajeno",
            "Designando a uno o varios trabajadores para que la lleven a cabo."
          ],
          correcta: 0
        },
        {
          pregunta: "En una empresa de 40 trabajadores es obligatorio que exista:",
          tipus: "test",
          opcions: [
            "Un Servicio de Prevenci贸n Propio.",
            "Uno o varios trabajadores designados.",
            "Un Servicio de Prevenci贸n Ajeno.",
            "Un comit茅 de seguridad y salud."
          ],
          correcta: 1
        },
        // Preguntas nuevas del PowerPoint - Nivel 1
        {
          pregunta: "驴Qu茅 tres elementos principales se relacionan en el contexto de la prevenci贸n de riesgos laborales?",
          tipus: "test",
          opcions: [
            "Producci贸n, Beneficios y Empleados",
            "Empresa, Trabajadores y Seguridad y Salud",
            "Costos, Calidad y Riesgos",
            "Mercado, Clientes y Proveedores"
          ],
          correcta: 1
        },
        {
          pregunta: "El trabajo, si se realiza en condiciones adecuadas a nuestras capacidades personales y en condiciones ambientales y de seguridad, puede suponer una fuente de ____________ personal y por tanto de salud.",
          tipus: "completar",
          correcta: "autorrealizaci贸n"
        },
        {
          pregunta: "驴Cu谩l es la principal raz贸n por la que trabajamos, seg煤n el temario?",
          tipus: "test",
          opcions: [
            "Por desarrollo personal",
            "Por dinero",
            "Para satisfacer nuestras necesidades",
            "Para una vida m谩s c贸moda"
          ],
          correcta: 2
        },
        {
          pregunta: "El objetivo fundamental de la prevenci贸n de riesgos laborales es:",
          tipus: "test",
          opcions: [
            "Reducir los costes empresariales.",
            "Aumentar la productividad de los trabajadores.",
            "Conseguir que las condiciones de trabajo no perjudiquen la salud de los trabajadores/as.",
            "Cumplir con las normativas legales m铆nimas."
          ],
          correcta: 2
        },
        {
          pregunta: "Relaciona cada t茅cnica preventiva con su objetivo principal:",
          tipus: "relacionar",
          parelles: [
            { esquerra: "Seguridad en el Trabajo", opciones: ["Estudia las condiciones materiales del trabajo para evitar accidentes.", "Se ocupa de los agentes contaminantes en el ambiente de trabajo.", "Se centra en el dise帽o de puestos de trabajo y el bienestar psicosocial.", "Analiza los factores psicosociales y la organizaci贸n del trabajo."], correcta: "Estudia las condiciones materiales del trabajo para evitar accidentes." },
            { esquerra: "Higiene Industrial", opciones: ["Estudia las condiciones materiales del trabajo para evitar accidentes.", "Se ocupa de los agentes contaminantes en el ambiente de trabajo.", "Se centra en el dise帽o de puestos de trabajo y el bienestar psicosocial.", "Analiza los factores psicosociales y la organizaci贸n del trabajo."], correcta: "Se ocupa de los agentes contaminantes en el ambiente de trabajo." },
            { esquerra: "Ergonom铆a", opciones: ["Estudia las condiciones materiales del trabajo para evitar accidentes.", "Se ocupa de los agentes contaminantes en el ambiente de trabajo.", "Se centra en el dise帽o de puestos de trabajo y el bienestar psicosocial.", "Analiza los factores psicosociales y la organizaci贸n del trabajo."], correcta: "Se centra en el dise帽o de puestos de trabajo y el bienestar psicosocial." },
            { esquerra: "Psicosociolog铆a Aplicada", opciones: ["Estudia las condiciones materiales del trabajo para evitar accidentes.", "Se ocupa de los agentes contaminantes en el ambiente de trabajo.", "Se centra en el dise帽o de puestos de trabajo y el bienestar psicosocial.", "Analiza los factores psicosociales y la organizaci贸n del trabajo."], correcta: "Analiza los factores psicosociales y la organizaci贸n del trabajo." }
          ]
        },
        {
          pregunta: "驴Qu茅 t茅cnica preventiva se encarga de analizar las condiciones materiales del trabajo para evitar accidentes?",
          tipus: "test",
          opcions: [
            "Higiene Industrial",
            "Ergonom铆a",
            "Seguridad en el Trabajo",
            "Medicina del Trabajo"
          ],
          correcta: 2
        },
        {
          pregunta: "Las enfermedades, patolog铆as o lesiones sufridas con motivo u ocasi贸n del trabajo se definen como ____________ del trabajo.",
          tipus: "completar",
          correcta: "da帽os derivados"
        },
        {
          pregunta: "驴Qu茅 tipo de riesgo est谩 relacionado con ca铆das, golpes o proyecciones?",
          tipus: "test",
          opcions: [
            "Riesgos higi茅nicos",
            "Riesgos psicosociales",
            "Riesgos de seguridad",
            "Riesgos ergon贸micos"
          ],
          correcta: 2
        },
        {
          pregunta: "Relaciona cada tipo de riesgo con un ejemplo:",
          tipus: "relacionar",
          parelles: [
            { esquerra: "Riesgos de seguridad", opciones: ["Ruido", "Estr茅s", "Ca铆da al mismo nivel", "Posturas forzadas"], correcta: "Ca铆da al mismo nivel" },
            { esquerra: "Riesgos higi茅nicos", opciones: ["Ruido", "Estr茅s", "Ca铆da al mismo nivel", "Posturas forzadas"], correcta: "Ruido" },
            { esquerra: "Riesgos ergon贸micos", opciones: ["Ruido", "Estr茅s", "Ca铆da al mismo nivel", "Posturas forzadas"], correcta: "Posturas forzadas" },
            { esquerra: "Riesgos psicosociales", opciones: ["Ruido", "Estr茅s", "Ca铆da al mismo nivel", "Posturas forzadas"], correcta: "Estr茅s" }
          ]
        },
        {
          pregunta: "Un __________ de trabajo es todo suceso que produce lesiones en el trabajador.",
          tipus: "completar",
          correcta: "accidente"
        },
        {
          pregunta: "驴Cu谩l de los siguientes NO es un tipo de riesgo, seg煤n la clasificaci贸n general?",
          tipus: "test",
          opcions: [
            "Riesgos de seguridad",
            "Riesgos econ贸micos",
            "Riesgos higi茅nicos",
            "Riesgos ergon贸micos"
          ],
          correcta: 1
        },
        {
          pregunta: "Una enfermedad profesional es la contra铆da a consecuencia del trabajo ejecutado por cuenta ajena en las actividades especificadas en el cuadro de enfermedades profesionales, y que est茅 provocada por los ____________ o __________ en dicho cuadro.",
          tipus: "completar",
          correcta: "agentes o procedimientos"
        },
        {
          pregunta: "驴Cu谩l es el principal derecho de los trabajadores en materia de prevenci贸n?",
          tipus: "test",
          opcions: [
            "Derecho a un salario m谩s alto.",
            "Derecho a la protecci贸n eficaz en materia de seguridad y salud.",
            "Derecho a elegir su horario de trabajo.",
            "Derecho a vacaciones pagadas."
          ],
          correcta: 1
        },
        {
          pregunta: "El empresario tiene la obligaci贸n de garantizar la __________ en materia de seguridad y salud en el trabajo.",
          tipus: "completar",
          correcta: "seguridad y salud"
        },
        {
          pregunta: "Relaciona la obligaci贸n del empresario con su descripci贸n:",
          tipus: "relacionar",
          parelles: [
            { esquerra: "Integraci贸n de la prevenci贸n", opciones: ["Formar e informar a los trabajadores.", "La prevenci贸n debe formar parte del sistema de gesti贸n de la empresa.", "Realizar una evaluaci贸n de los riesgos.", "Asegurar que los costes de prevenci贸n no recaen en el trabajador."], correcta: "La prevenci贸n debe formar parte del sistema de gesti贸n de la empresa." },
            { esquerra: "Evaluaci贸n de riesgos", opciones: ["Formar e informar a los trabajadores.", "La prevenci贸n debe formar parte del sistema de gesti贸n de la empresa.", "Realizar una evaluaci贸n de los riesgos.", "Asegurar que los costes de prevenci贸n no recaen en el trabajador."], correcta: "Realizar una evaluaci贸n de los riesgos." },
            { esquerra: "Informaci贸n y formaci贸n", opciones: ["Formar e informar a los trabajadores.", "La prevenci贸n debe formar parte del sistema de gesti贸n de la empresa.", "Realizar una evaluaci贸n de los riesgos.", "Asegurar que los costes de prevenci贸n no recaen en el trabajador."], correcta: "Formar e informar a los trabajadores." },
            { esquerra: "Asumir los costes", opciones: ["Formar e informar a los trabajadores.", "La prevenci贸n debe formar parte del sistema de gesti贸n de la empresa.", "Realizar una evaluaci贸n de los riesgos.", "Asegurar que los costes de prevenci贸n no recaen en el trabajador."], correcta: "Asegurar que los costes de prevenci贸n no recaen en el trabajador." }
          ]
        },
        {
          pregunta: "El empresario tiene la obligaci贸n de ___________ los riesgos laborales.",
          tipus: "completar",
          correcta: "evaluar"
        },
        {
          pregunta: "驴Qu茅 obligaci贸n tiene el trabajador respecto a su propia seguridad y la de terceros?",
          tipus: "test",
          opcions: [
            "Realizar las tareas que le correspondan, sin importar el riesgo.",
            "Cooperar con el empresario en el cumplimiento de las obligaciones preventivas.",
            "Ignorar las normas de seguridad si considera que son ineficientes.",
            "Asumir los costes de los equipos de protecci贸n personal."
          ],
          correcta: 1
        },
        {
          pregunta: "La prevenci贸n de riesgos laborales debe estar integrada en el sistema general de gesti贸n de la empresa, lo que se conoce como __________.",
          tipus: "completar",
          correcta: "integraci贸n de la prevenci贸n"
        },
        {
          pregunta: "Relaciona cada modalidad de organizaci贸n preventiva con su 谩mbito de aplicaci贸n general:",
          tipus: "relacionar",
          parelles: [
            { esquerra: "Asunci贸n personal por el empresario", opciones: ["Empresas con menos de 6 trabajadores y sin riesgos especiales.", "Empresas de cualquier tama帽o o con riesgos especiales.", "Empresas grandes o con riesgos importantes."], correcta: "Empresas con menos de 6 trabajadores y sin riesgos especiales." },
            { esquerra: "Trabajador/es Designado/s", opciones: ["Empresas con menos de 6 trabajadores y sin riesgos especiales.", "Empresas entre 6 y 50 trabajadores con riesgo normal, o 250 con un solo centro y riesgo normal.", "Empresas grandes o con riesgos importantes."], correcta: "Empresas entre 6 y 50 trabajadores con riesgo normal, o 250 con un solo centro y riesgo normal." },
            { esquerra: "Servicio de Prevenci贸n Ajeno", opciones: ["Empresas con menos de 6 trabajadores y sin riesgos especiales.", "Empresas entre 6 y 50 trabajadores con riesgo normal, o 250 con un solo centro y riesgo normal.", "Empresas que no pueden asumir la prevenci贸n con medios propios."], correcta: "Empresas que no pueden asumir la prevenci贸n con medios propios." }
          ]
        },
        {
          pregunta: "驴Cu谩l es el 贸rgano paritario y colegiado de participaci贸n destinado a la consulta regular y peri贸dica de las actuaciones de la empresa en materia de prevenci贸n de riesgos?",
          tipus: "test",
          opcions: [
            "El Comit茅 de Empresa",
            "El Comit茅 de Seguridad y Salud",
            "Los Delegados de Personal",
            "La Inspecci贸n de Trabajo"
          ],
          correcta: 1
        }
      ],
      2: [
        // Preguntas del PDF - Ejercicio 4 (Abiertas)
        {
          pregunta: "Si el empresario delega las actividades preventivas en trabajadores designados o en un servicio de prevenci贸n, 驴queda eximido de su responsabilidad?",
          tipus: "completar",
          correcta: "No, la responsabilidad es siempre indelegable."
        },
        {
          pregunta: "驴Sobre qui茅n recae el coste de las medidas relativas a la seguridad y salud en el trabajo?",
          tipus: "completar",
          correcta: "El coste recae sobre el empresario. Bajo ning煤n concepto puede recaer sobre el trabajador."
        },
        {
          pregunta: "驴El tiempo dedicado a la formaci贸n en prevenci贸n de riesgos laborales es tiempo de trabajo?",
          tipus: "completar",
          correcta: "S铆, se considera tiempo de trabajo a todos los efectos."
        },
        {
          pregunta: "驴A trav茅s de qui茅n se llevan a cabo las consultas que el empresario debe realizar a los trabajadores en materia de prevenci贸n?",
          tipus: "completar",
          correcta: "A trav茅s de los Delegados de Prevenci贸n o, en su defecto, a trav茅s de los Representantes de los Trabajadores."
        },
        {
          pregunta: "驴Tienen los trabajadores derecho a la confidencialidad de la informaci贸n relacionada con su estado de salud?",
          tipus: "completar",
          correcta: "S铆, tienen derecho a la confidencialidad de toda la informaci贸n relacionada con su estado de salud."
        },
        {
          pregunta: "驴Los trabajadores tienen necesariamente que ser acompa帽ados por los delegados de prevenci贸n para poner denuncias ante la Inspecci贸n de trabajo?",
          tipus: "completar",
          correcta: "No, los trabajadores no tienen necesariamente que ser acompa帽ados. Tienen derecho a acudir a la Inspecci贸n de Trabajo por s铆 solos."
        },
        // Preguntas del PDF - Ejercicio 5 (Relacionar)
        {
          pregunta: "Relaciona los siguientes conceptos con el tipo de riesgo al que corresponden:",
          tipus: "relacionar",
          parelles: [
            { esquerra: "Riesgos derivados de las condiciones de seguridad", opciones: ["CARGA MENTAL", "EL HORARIO Y EL RITMO DE TRABAJO", "EXPOSICIN A AGENTES BIOLGICOS", "HERRAMIENTAS Y EQUIPOS DE TRABAJO."], correcta: "HERRAMIENTAS Y EQUIPOS DE TRABAJO." },
            { esquerra: "Riesgos derivados de la organizaci贸n del trabajo", opciones: ["CARGA MENTAL", "EL HORARIO Y EL RITMO DE TRABAJO", "EXPOSICIN A AGENTES BIOLGICOS", "HERRAMIENTAS Y EQUIPOS DE TRABAJO."], correcta: "EL HORARIO Y EL RITMO DE TRABAJO" },
            { esquerra: "Riesgos derivados de la carga de trabajo", opciones: ["CARGA MENTAL", "EL HORARIO Y EL RITMO DE TRABAJO", "EXPOSICIN A AGENTES BIOLGICOS", "HERRAMIENTAS Y EQUIPOS DE TRABAJO."], correcta: "CARGA MENTAL" },
            { esquerra: "Riesgos derivados del medio ambiente de trabajo", opciones: ["CARGA MENTAL", "EL HORARIO Y EL RITMO DE TRABAJO", "EXPOSICIN A AGENTES BIOLGICOS", "HERRAMIENTAS Y EQUIPOS DE TRABAJO."], correcta: "EXPOSICIN A AGENTES BIOLGICOS" }
          ]
        },
        // Nuevas preguntas del PowerPoint - Nivel 2
        {
          pregunta: "驴Qu茅 significan las siglas EPI en el contexto de prevenci贸n de riesgos laborales?",
          tipus: "completar",
          correcta: "Equipo de Protecci贸n Individual"
        },
        {
          pregunta: "驴Cu谩l es el objetivo principal de la Medicina del Trabajo?",
          tipus: "test",
          opcions: [
            "Curar todas las enfermedades de los trabajadores.",
            "Promover la salud, curar enfermedades y rehabilitar en el 谩mbito laboral.",
            "Realizar reconocimientos m茅dicos anuales obligatorios.",
            "Dictaminar las causas de los accidentes laborales."
          ],
          correcta: 1
        },
        {
          pregunta: "La Medicina del Trabajo se especializa en la interacci贸n entre el ser humano y el medio __________.",
          tipus: "completar",
          correcta: "de trabajo"
        },
        {
          pregunta: "驴Qu茅 t茅cnica preventiva se enfoca en el estudio de las condiciones ambientales de trabajo y los agentes contaminantes?",
          tipus: "test",
          opcions: [
            "Seguridad en el Trabajo",
            "Higiene Industrial",
            "Ergonom铆a",
            "Psicosociolog铆a Aplicada"
          ],
          correcta: 1
        },
        {
          pregunta: "Un ejemplo de riesgo higi茅nico ser铆a la exposici贸n a:",
          tipus: "test",
          opcions: [
            "Ca铆das de objetos",
            "Estr茅s laboral",
            "Ruido excesivo",
            "Movimientos repetitivos"
          ],
          correcta: 2
        },
        {
          pregunta: "La __________ se ocupa del dise帽o de puestos de trabajo y la adaptaci贸n del trabajo a la persona.",
          tipus: "completar",
          correcta: "ergonom铆a"
        },
        {
          pregunta: "Relaciona el tipo de da帽o derivado del trabajo con su caracter铆stica principal:",
          tipus: "relacionar",
          parelles: [
            { esquerra: "Accidente de Trabajo", opciones: ["Suceso repentino", "Enfermedad de lenta aparici贸n", "Da帽o que no es accidente ni enfermedad profesional"], correcta: "Suceso repentino" },
            { esquerra: "Enfermedad Profesional", opciones: ["Suceso repentino", "Enfermedad de lenta aparici贸n", "Da帽o que no es accidente ni enfermedad profesional"], correcta: "Enfermedad de lenta aparici贸n" },
            { esquerra: "Otras patolog铆as o lesiones", opciones: ["Suceso repentino", "Enfermedad de lenta aparici贸n", "Da帽o que no es accidente ni enfermedad profesional"], correcta: "Da帽o que no es accidente ni enfermedad profesional" }
          ]
        },
        {
          pregunta: "Los ____________ son un conjunto de t茅cnicas y procedimientos que tienen por objeto eliminar o reducir el riesgo de que se produzcan accidentes de trabajo.",
          tipus: "completar",
          correcta: "riesgos de seguridad"
        },
        {
          pregunta: "驴Qu茅 es un 'incidente' en prevenci贸n de riesgos laborales?",
          tipus: "test",
          opcions: [
            "Un accidente con lesiones graves.",
            "Un suceso en el que no se producen da帽os ni lesiones, pero que podr铆a haberlos producido.",
            "Una enfermedad profesional reconocida.",
            "Una situaci贸n de estr茅s laboral."
          ],
          correcta: 1
        },
        {
          pregunta: "La Ley de Prevenci贸n de Riesgos Laborales establece el marco normativo b谩sico en Espa帽a para garantizar la seguridad y salud de los trabajadores. 驴En qu茅 a帽o fue aprobada?",
          tipus: "test",
          opcions: [
            "1985",
            "1995",
            "2005",
            "2015"
          ],
          correcta: 1
        },
        {
          pregunta: "Relaciona el concepto con su definici贸n:",
          tipus: "relacionar",
          parelles: [
            { esquerra: "Peligro", opciones: ["Situaci贸n o caracter铆stica intr铆nseca que puede causar da帽o.", "Probabilidad de que el da帽o se materialice.", "Conjunto de medidas para evitar o reducir riesgos."], correcta: "Situaci贸n o caracter铆stica intr铆nseca que puede causar da帽o." },
            { esquerra: "Riesgo", opciones: ["Situaci贸n o caracter铆stica intr铆nseca que puede causar da帽o.", "Probabilidad de que el da帽o se materialice.", "Conjunto de medidas para evitar o reducir riesgos."], correcta: "Probabilidad de que el da帽o se materialice." },
            { esquerra: "Prevenci贸n", opciones: ["Situaci贸n o caracter铆stica intr铆nseca que puede causar da帽o.", "Probabilidad de que el da帽o se materialice.", "Conjunto de medidas para evitar o reducir riesgos."], correcta: "Conjunto de medidas para evitar o reducir riesgos." }
          ]
        },
        {
          pregunta: "Las 'causas' de un accidente de trabajo pueden clasificarse en actos inseguros y __________ inseguras.",
          tipus: "completar",
          correcta: "condiciones"
        },
        {
          pregunta: "驴Cu谩l de las siguientes es una t茅cnica preventiva de la Medicina del Trabajo?",
          tipus: "test",
          opcions: [
            "Dise帽o de maquinaria",
            "Medici贸n de ruido",
            "Vigilancia de la salud",
            "Planificaci贸n de emergencias"
          ],
          correcta: 2
        },
        {
          pregunta: "Los equipos de protecci贸n individual (EPIs) son la primera medida de prevenci贸n a aplicar.",
          tipus: "test",
          opcions: ["Verdadero", "Falso"],
          correcta: 1 // Falso, son la 煤ltima barrera de protecci贸n, tras eliminar o reducir el riesgo en origen
        },
        {
          pregunta: "Un riesgo psicosocial puede estar relacionado con:",
          tipus: "test",
          opcions: [
            "Vibraciones",
            "Productos qu铆micos",
            "Estr茅s",
            "Cortes"
          ],
          correcta: 2
        }
      ],
      3: [
        // Nuevas preguntas del PowerPoint - Nivel 3
        {
          pregunta: "La Ley de Prevenci贸n de Riesgos Laborales se aplica a:",
          tipus: "test",
          opcions: [
            "Solo trabajadores por cuenta ajena.",
            "Trabajadores por cuenta ajena y aut贸nomos.",
            "Todos los trabajadores, incluyendo funcionarios y personal al servicio de las Administraciones P煤blicas.",
            "Empresarios 煤nicamente."
          ],
          correcta: 2
        },
        {
          pregunta: "El empresario debe garantizar la protecci贸n de los trabajadores frente a los riesgos laborales, mediante la adopci贸n de cu谩ntas medidas sean necesarias. Este principio se basa en el deber de ____________.",
          tipus: "completar",
          correcta: "protecci贸n"
        },
        {
          pregunta: "Relaciona el derecho del trabajador con su descripci贸n:",
          tipus: "relacionar",
          parelles: [
            { esquerra: "Derecho a la informaci贸n", opciones: ["Conocer los riesgos de su puesto y las medidas preventivas.", "Recibir formaci贸n espec铆fica y suficiente.", "Proponer mejoras en las condiciones de trabajo.", "Paralizar la actividad si hay riesgo grave e inminente."], correcta: "Conocer los riesgos de su puesto y las medidas preventivas." },
            { esquerra: "Derecho a la formaci贸n", opciones: ["Conocer los riesgos de su puesto y las medidas preventivas.", "Recibir formaci贸n espec铆fica y suficiente.", "Proponer mejoras en las condiciones de trabajo.", "Paralizar la actividad si hay riesgo grave e inminente."], correcta: "Recibir formaci贸n espec铆fica y suficiente." },
            { esquerra: "Derecho de participaci贸n y consulta", opciones: ["Conocer los riesgos de su puesto y las medidas preventivas.", "Recibir formaci贸n espec铆fica y suficiente.", "Proponer mejoras en las condiciones de trabajo.", "Paralizar la actividad si hay riesgo grave e inminente."], correcta: "Proponer mejoras en las condiciones de trabajo." },
            { esquerra: "Derecho a la paralizaci贸n", opciones: ["Conocer los riesgos de su puesto y las medidas preventivas.", "Recibir formaci贸n espec铆fica y suficiente.", "Proponer mejoras en las condiciones de trabajo.", "Paralizar la actividad si hay riesgo grave e inminente."], correcta: "Paralizar la actividad si hay riesgo grave e inminente." }
          ]
        },
        {
          pregunta: "驴Qu茅 medida se debe adoptar siempre antes de recurrir a los equipos de protecci贸n individual (EPIs)?",
          tipus: "test",
          opcions: [
            "Formar al trabajador en el uso del EPI.",
            "Evaluar el riesgo.",
            "Adoptar medidas de protecci贸n colectiva o eliminar el riesgo en origen.",
            "Vigilar la salud del trabajador."
          ],
          correcta: 2
        },
        {
          pregunta: "Los ____________ de Prevenci贸n son los representantes de los trabajadores con funciones espec铆ficas en materia de prevenci贸n de riesgos laborales.",
          tipus: "completar",
          correcta: "Delegados"
        },
        {
          pregunta: "El Comit茅 de Seguridad y Salud es obligatorio en empresas con m谩s de _________ trabajadores.",
          tipus: "completar",
          correcta: "50"
        },
        {
          pregunta: "Relaciona el documento preventivo con su objetivo:",
          tipus: "relacionar",
          parelles: [
            { esquerra: "Evaluaci贸n de Riesgos", opciones: ["Identificar los peligros y valorar los riesgos para la seguridad y salud.", "Definir c贸mo se van a controlar y reducir los riesgos identificados.", "Establecer la estructura de la gesti贸n preventiva en la empresa."], correcta: "Identificar los peligros y valorar los riesgos para la seguridad y salud." },
            { esquerra: "Planificaci贸n de la Actividad Preventiva", opciones: ["Identificar los peligros y valorar los riesgos para la seguridad y salud.", "Definir c贸mo se van a controlar y reducir los riesgos identificados.", "Establecer la estructura de la gesti贸n preventiva en la empresa."], correcta: "Definir c贸mo se van a controlar y reducir los riesgos identificados." },
            { esquerra: "Plan de Prevenci贸n", opciones: ["Identificar los peligros y valorar los riesgos para la seguridad y salud.", "Definir c贸mo se van a controlar y reducir los riesgos identificados.", "Establecer la estructura de la gesti贸n preventiva en la empresa."], correcta: "Establecer la estructura de la gesti贸n preventiva en la empresa." }
          ]
        },
        {
          pregunta: "La vigilancia de la salud debe ser ___________, salvo excepciones como las recogidas en la normativa.",
          tipus: "completar",
          correcta: "voluntaria"
        },
        {
          pregunta: "驴Qu茅 organismo es el encargado de la vigilancia y el control del cumplimiento de la normativa de prevenci贸n de riesgos laborales?",
          tipus: "test",
          opcions: [
            "El Servicio de Prevenci贸n de la empresa.",
            "El Comit茅 de Seguridad y Salud.",
            "La Inspecci贸n de Trabajo y Seguridad Social.",
            "Los Delegados de Prevenci贸n."
          ],
          correcta: 2
        },
        {
          pregunta: "Los accidentes de trabajo deben ser comunicados a la autoridad laboral en un plazo de _________ d铆as h谩biles.",
          tipus: "completar",
          correcta: "cinco"
        },
        {
          pregunta: "Relaciona el tipo de emergencia con la acci贸n principal:",
          tipus: "relacionar",
          parelles: [
            { esquerra: "Conato de emergencia", opciones: ["Se controla con los medios disponibles en el lugar de trabajo.", "Requiere la actuaci贸n de equipos de emergencia externos.", "Se extienden a varios sectores y requieren desalojo parcial.", "Requiere la evacuaci贸n total del centro de trabajo."], correcta: "Se controla con los medios disponibles en el lugar de trabajo." },
            { esquerra: "Emergencia parcial", opciones: ["Se controla con los medios disponibles en el lugar de trabajo.", "Requiere la actuaci贸n de equipos de emergencia externos.", "Se extienden a varios sectores y requieren desalojo parcial.", "Requiere la evacuaci贸n total del centro de trabajo."], correcta: "Se extienden a varios sectores y requieren desalojo parcial." },
            { esquerra: "Emergencia general", opciones: ["Se controla con los medios disponibles en el lugar de trabajo.", "Requiere la actuaci贸n de equipos de emergencia externos.", "Se extienden a varios sectores y requieren desalojo parcial.", "Requiere la evacuaci贸n total del centro de trabajo."], correcta: "Requiere la evacuaci贸n total del centro de trabajo." }
          ]
        },
        {
          pregunta: "驴Qui茅n es el responsable de elaborar y mantener actualizado el Plan de Autoprotecci贸n de la empresa?",
          tipus: "test",
          opcions: [
            "Los trabajadores designados.",
            "El Servicio de Prevenci贸n.",
            "El propio empresario.",
            "Un t茅cnico externo cualificado."
          ],
          correcta: 2 // El empresario es el responsable 煤ltimo de la prevenci贸n y, por ende, de los planes de autoprotecci贸n.
        },
        {
          pregunta: "La gesti贸n de la prevenci贸n en la empresa debe ser un proceso ____________ y ____________.",
          tipus: "completar",
          correcta: "continuo y din谩mico"
        },
        {
          pregunta: "驴Qu茅 tipo de EPI se utilizar铆a para proteger las manos de cortes?",
          tipus: "test",
          opcions: [
            "Casco de seguridad",
            "Gafas de protecci贸n",
            "Guantes anticorte",
            "Calzado de seguridad"
          ],
          correcta: 2
        },
        {
          pregunta: "Relaciona el tipo de EPI con la zona del cuerpo que protege:",
          tipus: "relacionar",
          parelles: [
            { esquerra: "Casco", opciones: ["V铆as respiratorias", "Cabeza", "Pies", "Ojos"], correcta: "Cabeza" },
            { esquerra: "Mascarilla", opciones: ["V铆as respiratorias", "Cabeza", "Pies", "Ojos"], correcta: "V铆as respiratorias" },
            { esquerra: "Botas de seguridad", opciones: ["V铆as respiratorias", "Cabeza", "Pies", "Ojos"], correcta: "Pies" },
            { esquerra: "Gafas de seguridad", opciones: ["V铆as respiratorias", "Cabeza", "Pies", "Ojos"], correcta: "Ojos" }
          ]
        },
        {
          pregunta: "La Ley de Prevenci贸n de Riesgos Laborales tiene como objetivo promover la mejora de las condiciones de trabajo para elevar el nivel de ____________ y ____________ de los trabajadores.",
          tipus: "completar",
          correcta: "seguridad y salud"
        },
        {
          pregunta: "驴Qu茅 principio de la acci贸n preventiva implica adaptar el trabajo a la persona?",
          tipus: "test",
          opcions: [
            "Planificaci贸n de la prevenci贸n",
            "Evitar los riesgos",
            "Evaluar los riesgos inevitables",
            "Adaptar el trabajo a la persona, en particular en lo que respecta a la concepci贸n de los puestos de trabajo."
          ],
          correcta: 3
        },
        {
          pregunta: "Las medidas de emergencia deben incluir los ___________, la ___________ y los ___________ en caso de siniestro.",
          tipus: "completar",
          correcta: "primeros auxilios, lucha contra incendios, evacuaci贸n de los trabajadores"
        },
        {
          pregunta: "El principio de 'integrar la prevenci贸n en el conjunto de actividades de la empresa' significa que debe estar presente en todas las decisiones y en todos los __________.",
          tipus: "completar",
          correcta: "niveles"
        },
        {
          pregunta: "驴Qu茅 importancia tiene la 'cooperaci贸n' entre empresario y trabajadores en la prevenci贸n de riesgos?",
          tipus: "test",
          opcions: [
            "Es opcional y no afecta a la eficacia preventiva.",
            "Es fundamental para el 茅xito de la acci贸n preventiva.",
            "Solo es necesaria en empresas con muchos trabajadores.",
            "Es responsabilidad exclusiva del empresario."
          ],
          correcta: 1
        }
      ]
    };

    let nivellActual = 0;
    let preguntesActuals = [];
    let preguntaIndexActual = 0;
    let encerts = 0;
    let totalPreguntesRespostes = 0; // Preguntes que el usuari ja ha intentat respondre (encertades o fallades)
    let preguntesPendentsRepas = []; // Para el modo repaso, almacena las preguntas falladas
    let modeRepasActiu = false;

    const quizContainer = document.getElementById('quiz-container');
    const questionArea = document.getElementById('question-area');
    const feedbackDiv = document.getElementById('feedback');
    const scoreDisplay = document.getElementById('score');
    const nextBtn = document.getElementById('next-btn');
    const progressBar = document.getElementById('progress-bar');
    const progressContainer = document.getElementById('progress-container');
    const barraNivells = document.getElementById('barra-nivells');

    // Modals
    const nivellCompletatModal = document.getElementById('nivellCompletatModal');
    const nivellCompletatText = document.getElementById('nivellCompletatText');
    const botoPujarNivell = document.getElementById('botoPujarNivell');
    const repasModal = document.getElementById('repasModal');
    const preguntesFalladesContainer = document.getElementById('preguntesFalladesContainer');
    const finalTestModal = document.getElementById('finalTestModal');

    // Listener para el bot贸n "Seg眉ent"
    nextBtn.addEventListener('click', () => {
      preguntaIndexActual++;
      feedbackDiv.textContent = ''; // Limpiar feedback
      nextBtn.classList.add('hidden'); // Ocultar bot贸n
      mostrarPregunta();
    });

    function iniciaNivell(nivell) {
      nivellActual = nivell;
      preguntesActuals = [...totsElsNivellsPreguntes[nivellActual]]; // Copia de las preguntas del nivel
      preguntaIndexActual = 0;
      encerts = 0;
      totalPreguntesRespostes = 0;
      preguntesPendentsRepas = [];
      modeRepasActiu = false;

      // Shuffle questions for the current level
      preguntesActuals = shuffleArray(preguntesActuals);

      quizContainer.classList.remove('hidden');
      progressContainer.classList.remove('hidden');
      scoreDisplay.textContent = `Encerts: 0 / 0`;
      updateProgressBar();
      mostrarPregunta();
      amagaModal(); // Asegurarse de que los modales est茅n ocultos al iniciar nivel
      amagaRepasModal();
      amagaFinalTestModal();
      actualitzaEstatBotonsNivell();
    }

    function actualitzaEstatBotonsNivell() {
      document.querySelectorAll('.level-button').forEach(btn => {
        btn.disabled = false;
        btn.classList.remove('bg-gray-400', 'cursor-not-allowed');
      });
      // Deshabilitar botones de niveles superiores si el nivel actual no est谩 completado (opcional, para forzar orden)
      // for (let i = 1; i <= Object.keys(totsElsNivellsPreguntes).length; i++) {
      //   const btn = document.querySelector(`.level-button[onclick="iniciaNivell(${i})"]`);
      //   if (i > nivellActual && nivellActual !== 0) { // Si no estamos en el primer nivel y es un nivel superior
      //     btn.disabled = true;
      //     btn.classList.add('bg-gray-400', 'cursor-not-allowed');
      //   }
      // }
    }


    function mostrarPregunta() {
      if (preguntaIndexActual < preguntesActuals.length) {
        const pregunta = preguntesActuals[preguntaIndexActual];
        questionArea.innerHTML = ''; // Limpiar contenido anterior

        const preguntaText = document.createElement('p');
        preguntaText.classList.add('mb-4', 'font-medium', 'text-xl');
        preguntaText.innerHTML = pregunta.pregunta;
        questionArea.appendChild(preguntaText);

        switch (pregunta.tipus) {
          case 'test':
            mostrarPreguntaTest(pregunta);
            break;
          case 'completar':
            mostrarPreguntaCompletar(pregunta);
            break;
          case 'relacionar':
            mostrarPreguntaRelacionar(pregunta);
            break;
        }
        feedbackDiv.textContent = '';
        nextBtn.classList.add('hidden'); // Ocultar el bot贸n "Siguiente" hasta que se responda
        desbloquejaInteraccio(); // Asegurarse de que las opciones est茅n habilitadas
      } else {
        // Nivel completado
        mostraNivellCompletatModal();
      }
    }

    function mostrarPreguntaTest(pregunta) {
      const opcionesDiv = document.createElement('div');
      opcionesDiv.id = 'opcions';
      opcionesDiv.classList.add('grid', 'grid-cols-1', 'gap-3');

      pregunta.opcions.forEach((opcion, index) => {
        const button = document.createElement('button');
        button.classList.add('opc', 'w-full', 'text-left', 'px-4', 'py-3', 'mb-2', 'border', 'rounded-lg', 'bg-gray-50', 'hover:bg-gray-100', 'transition-colors', 'duration-150');
        button.innerHTML = opcion;
        button.onclick = () => validarRespuestaTest(index, pregunta.correcta);
        opcionesDiv.appendChild(button);
      });
      questionArea.appendChild(opcionesDiv);
    }

    function validarRespuestaTest(selectedIndex, correctAnswerIndex) {
      const buttons = questionArea.querySelectorAll('.opc');
      bloquejaInteraccio(); // Deshabilitar botones una vez que se ha respondido
      totalPreguntesRespostes++;

      if (selectedIndex === correctAnswerIndex) {
        buttons[selectedIndex].classList.add('bg-green-300', 'text-green-800');
        feedbackDiv.innerHTML = "<p class='text-green-600 font-bold'> Molt b茅, has encertat la pregunta!</p>";
        encerts++;
      } else {
        buttons[selectedIndex].classList.add('bg-red-300', 'text-red-800');
        buttons[correctAnswerIndex].classList.add('bg-green-300', 'text-green-800'); // Mostrar la correcta
        feedbackDiv.innerHTML = "<p class='text-red-600 font-bold'> Ohhh! No 茅s correcte!</p>";
        preguntesPendentsRepas.push(preguntesActuals[preguntaIndexActual]);
      }
      nextBtn.classList.remove('hidden');
      scoreDisplay.textContent = `Encerts: ${encerts} / ${totalPreguntesRespostes}`;
      updateProgressBar();
    }

    function mostrarPreguntaCompletar(pregunta) {
      const inputDiv = document.createElement('div');
      inputDiv.classList.add('mb-4');
      inputDiv.innerHTML = `
        <label for="respuesta-completar" class="block text-lg font-medium mb-2">Completa la frase:</label>
        <input type="text" id="respuesta-completar" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Escriu la teva resposta aqu铆...">
        <button id="validar-completar" class="mt-4 bg-blue-600 text-white px-5 py-2 rounded-lg hover:bg-blue-700 transition-colors duration-200">Comprova</button>
      `;
      questionArea.appendChild(inputDiv);

      document.getElementById('validar-completar').onclick = () => validarRespuestaCompletar(pregunta.correcta);
      document.getElementById('respuesta-completar').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          document.getElementById('validar-completar').click();
        }
      });
    }

    function validarRespuestaCompletar(respuestaCorrecta) {
      const input = document.getElementById('respuesta-completar');
      const userAnswer = input.value.trim().toLowerCase();
      const normalizedCorrectAnswer = typeof respuestaCorrecta === 'string' ? respuestaCorrecta.toLowerCase() : respuestaCorrecta;

      input.disabled = true; // Deshabilitar input
      document.getElementById('validar-completar').disabled = true; // Deshabilitar bot贸n de validar
      totalPreguntesRespostes++;

      if (userAnswer === normalizedCorrectAnswer) {
        input.classList.add('bg-green-100', 'border-green-500');
        feedbackDiv.innerHTML = `<p class='text-green-600 font-bold'> Molt b茅! La resposta 茅s: ${respuestaCorrecta}</p>`;
        encerts++;
      } else {
        input.classList.add('bg-red-100', 'border-red-500');
        feedbackDiv.innerHTML = `<p class='text-red-600 font-bold'> No 茅s correcte. La resposta correcta 茅s: <strong>${respuestaCorrecta}</strong></p>`;
        preguntesPendentsRepas.push(preguntesActuals[preguntaIndexActual]);
      }
      nextBtn.classList.remove('hidden');
      scoreDisplay.textContent = `Encerts: ${encerts} / ${totalPreguntesRespostes}`;
      updateProgressBar();
    }

    function mostrarPreguntaRelacionar(pregunta) {
      const relacionarDiv = document.createElement('div');
      relacionarDiv.classList.add('grid', 'grid-cols-2', 'gap-4', 'mb-4');

      let opcionesDerecha = pregunta.parelles.map(p => p.opciones).flat();
      opcionesDerecha = shuffleArray(opcionesDerecha); // Mezclar opciones de la derecha

      pregunta.parelles.forEach((pareja, index) => {
        const leftSide = document.createElement('div');
        leftSide.classList.add('text-lg', 'font-medium', 'py-2');
        leftSide.textContent = pareja.esquerra;
        relacionarDiv.appendChild(leftSide);

        const selectDiv = document.createElement('div');
        const select = document.createElement('select');
        select.id = `relacionar-${index}`;
        select.classList.add('w-full', 'px-3', 'py-2', 'border', 'rounded-lg', 'bg-white', 'focus:ring-2', 'focus:ring-blue-500');

        const defaultOption = document.createElement('option');
        defaultOption.value = "";
        defaultOption.textContent = "Selecciona una opci贸n";
        defaultOption.disabled = true;
        defaultOption.selected = true;
        select.appendChild(defaultOption);

        opcionesDerecha.forEach(opcion => {
          const option = document.createElement('option');
          option.value = opcion;
          option.textContent = opcion;
          select.appendChild(option);
        });
        selectDiv.appendChild(select);
        relacionarDiv.appendChild(selectDiv);
      });

      questionArea.appendChild(relacionarDiv);

      const validarBtn = document.createElement('button');
      validarBtn.id = 'validar-relacionar';
      validarBtn.classList.add('mt-4', 'bg-blue-600', 'text-white', 'px-5', 'py-2', 'rounded-lg', 'hover:bg-blue-700', 'transition-colors', 'duration-200');
      validarBtn.textContent = 'Comprova';
      validarBtn.onclick = () => validarRespuestaRelacionar(pregunta);
      questionArea.appendChild(validarBtn);
    }

    function validarRespuestaRelacionar(pregunta) {
      const selects = questionArea.querySelectorAll('select');
      let allCorrect = true;
      totalPreguntesRespostes++;

      selects.forEach((select, index) => {
        select.disabled = true; // Deshabilitar select
        const correctAnswer = pregunta.parelles[index].correcta;
        if (select.value === correctAnswer) {
          select.classList.add('bg-green-100', 'border-green-500');
        } else {
          allCorrect = false;
          select.classList.add('bg-red-100', 'border-red-500');
          // Opcional: mostrar la respuesta correcta
          const correctOption = document.createElement('span');
          correctOption.classList.add('ml-2', 'text-green-700', 'font-semibold');
          correctOption.textContent = `(Correcta: ${correctAnswer})`;
          select.parentNode.appendChild(correctOption);
        }
      });

      document.getElementById('validar-relacionar').disabled = true; // Deshabilitar bot贸n de validar

      if (allCorrect) {
        feedbackDiv.innerHTML = "<p class='text-green-600 font-bold'> Molt b茅, has encertat totes les relacions!</p>";
        encerts++;
      } else {
        feedbackDiv.innerHTML = "<p class='text-red-600 font-bold'> No totes les relacions s贸n correctes. Revisa les respostes marcades.</p>";
        preguntesPendentsRepas.push(preguntesActuals[preguntaIndexActual]);
      }
      nextBtn.classList.remove('hidden');
      scoreDisplay.textContent = `Encerts: ${encerts} / ${totalPreguntesRespostes}`;
      updateProgressBar();
    }


    function updateProgressBar() {
      const totalPreguntesNivell = preguntesActuals.length;
      const percentatge = (preguntaIndexActual / totalPreguntesNivell) * 100;
      progressBar.style.width = `${percentatge}%`;
      progressBar.textContent = `${Math.round(percentatge)}%`;
    }

    function bloquejaInteraccio() {
      const buttons = questionArea.querySelectorAll('button.opc');
      buttons.forEach(btn => btn.disabled = true);
      const input = questionArea.querySelector('input[type="text"]');
      if (input) input.disabled = true;
      const selects = questionArea.querySelectorAll('select');
      selects.forEach(sel => sel.disabled = true);
      const validarBtn = questionArea.querySelector('#validar-completar, #validar-relacionar');
      if (validarBtn) validarBtn.disabled = true;
    }

    function desbloquejaInteraccio() {
      const buttons = questionArea.querySelectorAll('button.opc');
      buttons.forEach(btn => btn.disabled = false);
      const input = questionArea.querySelector('input[type="text"]');
      if (input) input.disabled = false;
      const selects = questionArea.querySelectorAll('select');
      selects.forEach(sel => sel.disabled = false);
      const validarBtn = questionArea.querySelector('#validar-completar, #validar-relacionar');
      if (validarBtn) validarBtn.disabled = false;
    }

    // Funciones de los Modales
    function mostraNivellCompletatModal() {
      nivellCompletatText.textContent = `Has completat el Nivell ${nivellActual}!`;
      if (nivellActual < Object.keys(totsElsNivellsPreguntes).length) {
        botoPujarNivell.classList.remove('hidden');
      } else {
        botoPujarNivell.classList.add('hidden'); // ltim nivell, no hi ha m茅s per pujar
      }
      nivellCompletatModal.style.display = 'flex'; // Mostrar el modal
    }

    function amagaModal() {
      nivellCompletatModal.style.display = 'none'; // Amagar el modal
    }

    function repetirNivell() {
      amagaModal();
      iniciaNivell(nivellActual); // Reinicia el nivell actual
    }

    function pujarNivell() {
      if (nivellActual < Object.keys(totsElsNivellsPreguntes).length) {
        amagaModal();
        iniciaNivell(nivellActual + 1); // Passa al seg眉ent nivell
      } else {
        mostraFinalTestModal(); // Si ja no hi ha m茅s nivells
      }
    }

    function mostraFinalTestModal() {
      finalTestModal.style.display = 'flex';
    }

    function amagaFinalTestModal() {
      finalTestModal.style.display = 'none';
    }

    function mostraRepasFallades() {
      amagaFinalTestModal(); // Asegurarse de ocultar el modal de final de test
      preguntesFalladesContainer.innerHTML = '';
      if (preguntesPendentsRepas.length === 0) {
        preguntesFalladesContainer.innerHTML = '<p class="text-gray-600">隆No has tingut cap fallada en aquest nivell! Genial!</p>';
      } else {
        preguntesPendentsRepas.forEach((q, index) => {
          const divPregunta = document.createElement('div');
          divPregunta.classList.add('mb-4', 'p-3', 'border', 'rounded-md', 'bg-white', 'shadow-sm');
          divPregunta.innerHTML = `<p class="font-bold text-red-700 mb-1">Pregunta fallada ${index + 1}:</p><p class="mb-2">${q.pregunta}</p>`;
          
          if (q.tipus === 'test') {
            const respostaCorrectaText = q.opcions[q.correcta];
            divPregunta.innerHTML += `<p class="text-green-600">**Resposta correcta:** ${respostaCorrectaText}</p>`;
          } else if (q.tipus === 'completar') {
            divPregunta.innerHTML += `<p class="text-green-600">**Resposta correcta:** ${q.correcta}</p>`;
          } else if (q.tipus === 'relacionar') {
            divPregunta.innerHTML += `<p class="text-green-600 font-bold">**Relacions correctes:**</p><ul>`;
            q.parelles.forEach(p => {
              divPregunta.innerHTML += `<li>${p.esquerra}: <strong>${p.correcta}</strong></li>`;
            });
            divPregunta.innerHTML += `</ul>`;
          }
          preguntesFalladesContainer.appendChild(divPregunta);
        });
      }
      repasModal.style.display = 'flex';
    }

    function amagaRepasModal() {
      repasModal.style.display = 'none';
    }

    // Utility function to shuffle an array (Fisher-Yates algorithm)
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]]; // Swap elements
      }
      return array;
    }

    // Inicializaci贸n al cargar la p谩gina (opcional, si quieres que se vea algo antes de seleccionar nivel)
    // document.addEventListener('DOMContentLoaded', () => {
    //   // Puedes iniciar un nivel por defecto o mostrar una pantalla de bienvenida
    //   // iniciaNivell(1);
    // });

  </script>
</body>
</html>